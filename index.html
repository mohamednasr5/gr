<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>🕋 صدقة جارية على روح جيهان نصر</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --gold: #d4af37;
      --dark1: #0a1a12;
      --dark2: #102c1b;
      --accent: #2b7a50;
      --accent2: #1d5a3a;
      --muted: #c9e4d6;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:'Cairo',sans-serif;
      background:linear-gradient(135deg,rgba(16,44,27,0.95),rgba(8,20,13,0.95)),
        url('https://upload.wikimedia.org/wikipedia/commons/0/0a/Kaaba_masjid_al-haram_Makkah.jpg');
      background-size:cover;
      background-position:center;
      background-attachment:fixed;
      min-height:100vh;
      color:var(--muted);
      padding:20px;
    }
    h1,h2,h3{color:var(--gold)}
    .container{max-width:1200px;margin:0 auto}
    .header{
      text-align:center;
      background:rgba(0,0,0,0.55);
      border:2px solid var(--gold);
      border-radius:20px;
      padding:25px;
      box-shadow:0 10px 35px rgba(0,0,0,0.45);
      margin-bottom:25px;
    }
    .header h1{font-size:28px;margin-bottom:5px;text-shadow:0 2px 8px rgba(0,0,0,0.5)}
    .header p{color:#e0d8b3}
    .header .ded{color:#b6d3c4;font-weight:700;margin-top:8px}
    .audio{margin-top:18px;display:flex;justify-content:center;gap:10px;flex-wrap:wrap}
    button{
      cursor:pointer;border:none;font-family:'Cairo',sans-serif;font-weight:700;
      transition:0.3s;border-radius:8px;
    }
    .btn-primary{
      background:linear-gradient(135deg,#d4af37,#c9a961);
      color:#0e2417;padding:10px 20px;
      box-shadow:0 6px 20px rgba(212,175,55,0.3);
    }
    .btn-primary:hover{transform:translateY(-2px)}
    .btn-secondary{
      background:linear-gradient(135deg,#2b7a50,#1d5a3a);
      color:var(--gold);border:2px solid var(--gold);
      padding:10px 20px;box-shadow:0 6px 20px rgba(43,122,80,0.3);
    }
    .btn-secondary:hover{transform:translateY(-2px)}
    .upload{
      text-align:center;background:rgba(0,0,0,0.55);
      border:2px dashed var(--gold);border-radius:15px;
      padding:30px;margin:30px 0;box-shadow:0 10px 35px rgba(0,0,0,0.45);
    }
    .upload h2{margin-bottom:15px}
    .upload input{display:none}
    .upload label{
      display:inline-block;background:linear-gradient(135deg,#d4af37,#c9a961);
      color:#0a1a12;padding:14px 28px;border-radius:10px;font-weight:700;cursor:pointer;
      box-shadow:0 5px 20px rgba(212,175,55,0.3);
    }
    .grid{
      display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:15px;
    }
    .card{
      background:rgba(16,44,27,0.75);
      border:2px solid rgba(212,175,55,0.35);
      border-radius:15px;padding:12px;
      box-shadow:0 8px 20px rgba(0,0,0,0.4);position:relative;
    }
    .idx{
      position:absolute;top:10px;right:10px;
      background:linear-gradient(135deg,#d4af37,#c9a961);
      color:#102c1b;font-weight:800;width:40px;height:40px;
      border-radius:50%;display:flex;align-items:center;justify-content:center;
      border:2px solid #fff;box-shadow:0 6px 20px rgba(212,175,55,0.3);
    }
    .card img{
      width:100%;height:260px;object-fit:cover;
      border-radius:10px;margin-bottom:8px;border:2px solid rgba(212,175,55,0.3);
    }
    .form-group{margin-top:10px}
    .form-group label{color:var(--gold);font-weight:700;font-size:14px}
    .radio-group{display:flex;gap:10px;margin-top:5px}
    .radio-group label{color:var(--muted);font-weight:500;font-size:14px;cursor:pointer}
    input[type=number]{width:100%;padding:10px;border:2px solid rgba(212,175,55,0.35);
      border-radius:8px;background:rgba(20,60,40,0.5);color:var(--muted)}
    .merge-section{
      margin-top:35px;background:rgba(0,0,0,0.55);
      border:2px solid var(--gold);border-radius:18px;
      padding:20px;box-shadow:0 10px 30px rgba(0,0,0,0.45);
    }
    .merge-section h3{text-align:center;margin-bottom:15px}
    canvas{
      max-width:100%;display:block;margin:auto;
      border-radius:12px;border:2px solid rgba(212,175,55,0.3);
    }
    .merge-actions{margin-top:15px;display:flex;justify-content:center;gap:10px;flex-wrap:wrap}
    .footer{
      margin-top:50px;text-align:center;color:var(--gold);
      background:linear-gradient(135deg,rgba(0,0,0,0.8),rgba(0,0,0,0.7)),
        url('https://github.com/mohamednasr5/gr/blob/7154046be16e83c9f5002d43e245b6d4fca26844/pngtree-islamic-pilgrimage-to-mecca-eid-adha-mubarak-realistic-kaaba-image_16742354.jpg');
      background-size:cover;background-position:center;
      padding:25px;border-top:3px solid var(--gold);
      border-radius:15px;box-shadow:0 10px 25px rgba(0,0,0,0.5);
    }
    .toast{
      position:fixed;bottom:25px;right:25px;
      background:linear-gradient(135deg,#2b7a50,#1d5a3a);
      color:var(--gold);padding:14px 20px;border:2px solid var(--gold);
      border-radius:10px;box-shadow:0 8px 25px rgba(0,0,0,0.5);
      opacity:0;transition:.3s;
    }
    .toast.show{opacity:1}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>✦ من برمجة المهندس محمد حمّاد ✦</h1>
      <p>صدقة جارية على أخته المرحومة <strong>جيهان نصر</strong></p>
      <p class="ded">نسألكم الدعاء لها بالرحمة والمغفرة ودخول الفردوس الأعلى ❤️</p>
      <div class="audio">
        <audio id="quranAudio" autoplay volume="0.3">
          <source src="https://raw.githubusercontent.com/mohamednasr5/gr/main/download.wav" type="audio/wav">
        </audio>
        <button class="btn-primary" onclick="playQuran()">▶️ تشغيل الدعاء</button>
        <button class="btn-secondary" onclick="pauseQuran()">⏸️ إيقاف الدعاء</button>
      </div>
    </div>

    <div class="upload">
      <h2>📸 اختر صورك لإعداد البرومبت</h2>
      <input id="photoInput" type="file" accept="image/*" multiple>
      <label for="photoInput">اختر الصور</label>
    </div>

    <div id="previewGrid" class="grid"></div>

    <div class="merge-section" id="mergeSection" style="display:none">
      <h3>🕋 الصورة المدمجة (تُحدث تلقائيًا)</h3>
      <canvas id="mergedCanvas"></canvas>
      <div class="merge-actions">
        <button class="btn-primary" onclick="downloadMerged()">⬇️ تحميل الصورة المدمجة</button>
        <button class="btn-secondary" onclick="copyPrompt()">📋 نسخ البرومبت (التعليمات)</button>
      </div>
    </div>

    <div class="footer">
      🕌 تم التصميم والبرمجة بعناية | بإهداء إلى روح المرحومة <strong>جيهان نصر</strong><br>
      © Eng. Mohamed Hammad |صدقة جارية على روح جيهان نصر
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script>
    const toast=(t)=>{const n=document.getElementById('toast');n.textContent=t;n.classList.add('show');setTimeout(()=>n.classList.remove('show'),2000)};
    const audio=document.getElementById('quranAudio');
    audio.volume=0.3;
    function playQuran(){audio.play().catch(()=>toast('🎧 تحتاج لتفاعل يدوي لتشغيل الصوت'));}
    function pauseQuran(){audio.pause();toast('⏸️ تم إيقاف الدعاء');}

    const photoInput=document.getElementById('photoInput');
    const previewGrid=document.getElementById('previewGrid');
    const mergeSection=document.getElementById('mergeSection');
    const mergedCanvas=document.getElementById('mergedCanvas');
    let uploaded=[];

    photoInput.addEventListener('change',e=>{
      uploaded=[];
      const files=Array.from(e.target.files);
      files.forEach((file,i)=>{
        const reader=new FileReader();
        reader.onload=(ev)=>{
          const img=new Image();
          img.onload=()=>{
            uploaded.push({src:ev.target.result,img,gender:'Male',age:25});
            renderGrid();
          };
          img.src=ev.target.result;
        };
        reader.readAsDataURL(file);
      });
    });

    function renderGrid(){
      previewGrid.innerHTML='';
      uploaded.forEach((p,i)=>{
        const card=document.createElement('div');
        card.className='card';
        card.innerHTML=`
          <div class="idx">${i+1}</div>
          <img src="${p.src}" alt="photo ${i+1}">
          <div class="form-group">
            <label>النوع:</label>
            <div class="radio-group">
              <label><input type="radio" name="g${i}" value="Male" ${p.gender==='Male'?'checked':''}> ذكر</label>
              <label><input type="radio" name="g${i}" value="Female" ${p.gender==='Female'?'checked':''}> أنثى</label>
            </div>
          </div>
          <div class="form-group">
            <label>العمر:</label>
            <input type="number" min="1" max="120" value="${p.age}">
          </div>
        `;
        card.querySelectorAll('input[type=radio]').forEach(r=>r.addEventListener('change',ev=>{p.gender=ev.target.value;updateMerged();}));
        card.querySelector('input[type=number]').addEventListener('change',ev=>{p.age=parseInt(ev.target.value)||25;});
        previewGrid.appendChild(card);
      });
      if(uploaded.length>0){mergeSection.style.display='block';mergeImages();}
      else mergeSection.style.display='none';
    }

    function mergeImages(){
      const ctx=mergedCanvas.getContext('2d');
      const h=400, ratio=3/4, w=h*ratio;
      const pad=25;
      const totalW=pad+uploaded.length*(w+pad);
      const totalH=h+pad*2+25;
      mergedCanvas.width=totalW;
      mergedCanvas.height=totalH;
      const grad=ctx.createLinearGradient(0,0,totalW,totalH);
      grad.addColorStop(0,'#1a472a');grad.addColorStop(1,'#0d2817');
      ctx.fillStyle=grad;ctx.fillRect(0,0,totalW,totalH);
      ctx.strokeStyle='#d4af37';ctx.lineWidth=3;roundRect(ctx,5,5,totalW-10,totalH-10,12);ctx.stroke();

      uploaded.forEach((p,i)=>{
        const img=p.img;
        const srcRatio=img.width/img.height;
        const targetRatio=ratio;
        let sx,sy,sw,sh;
        if(srcRatio>targetRatio){sh=img.height;sw=sh*targetRatio;sx=(img.width-sw)/2;sy=0;}
        else{sw=img.width;sh=sw/targetRatio;sx=0;sy=(img.height-sh)/2;}
        const x=pad+i*(w+pad), y=pad+10;
        ctx.fillStyle='rgba(52,115,73,0.5)';
        roundRect(ctx,x-6,y-6,w+12,h+12,12);ctx.fill();
        ctx.save();
        ctx.shadowColor='rgba(0,0,0,0.3)';ctx.shadowBlur=12;
        ctx.drawImage(img,sx,sy,sw,sh,x,y,w,h);
        ctx.restore();
        const bx=x+w/2, by=y-15, r=18;
        ctx.fillStyle='#d4af37';ctx.beginPath();ctx.arc(bx,by,r,0,Math.PI*2);ctx.fill();
        ctx.strokeStyle='#fff';ctx.lineWidth=2;ctx.beginPath();ctx.arc(bx,by,r,0,Math.PI*2);ctx.stroke();
        ctx.fillStyle='#fff';ctx.font='bold 18px Cairo';ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText(i+1,bx,by);
      });
    }

    function roundRect(ctx,x,y,w,h,r){const rr=Math.min(r,w/2,h/2);ctx.beginPath();ctx.moveTo(x+rr,y);ctx.arcTo(x+w,y,x+w,y+h,rr);ctx.arcTo(x+w,y+h,x,y+h,rr);ctx.arcTo(x,y+h,x,y,rr);ctx.arcTo(x,y,x+w,y,rr);ctx.closePath();}
    function updateMerged(){if(uploaded.length>0)mergeImages();}
    function downloadMerged(){const a=document.createElement('a');a.href=mergedCanvas.toDataURL('image/png');a.download='merged.png';a.click();toast('✅ تم تحميل الصورة المدمجة');}
    function copyPrompt(){
      let text=`CRITICAL INSTRUCTIONS (by Eng. Mohamed Hammad):\n\nUse only the faces from uploaded images — ignore backgrounds and borders.\nMaintain 100.999% facial identity accuracy.\n\nSubject Information:\n`;
      uploaded.forEach((p,i)=>{text+=`Photo ${i+1}: ${p.gender}, approximately ${p.age} years old.\n`;});
      text+=`\nAll subjects to stand side by side before the Holy Kaaba.\nMales wear white ihram, females white abaya and hijab.\nLighting: Natural daylight. Camera: Eye-level, realistic style.\nPose: Each holding a Quran, calm spiritual expressions.\nOutput: One seamless professional image, no visible edits.`;
      navigator.clipboard.writeText(text).then(()=>toast('📋 تم نسخ البرومبت بنجاح'));
    }
  </script>
</body>
</html>

